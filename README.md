# STM32F103 + MAX30102 å¿ƒç‡è¡€æ°§ç›‘æµ‹ç³»ç»Ÿ

åŸºäº STM32F103C8T6 å’Œ MAX30102 ä¼ æ„Ÿå™¨çš„å®æ—¶å¿ƒç‡å’Œè¡€æ°§é¥±å’Œåº¦ç›‘æµ‹ç³»ç»Ÿï¼Œå¸¦æœ‰ OLED å®æ—¶æ³¢å½¢æ˜¾ç¤ºã€‚

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„åŒ»ç–—çº§å¿ƒç‡è¡€æ°§ç›‘æµ‹ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- ğŸ«€ **å‡†ç¡®çš„å¿ƒç‡æ£€æµ‹**ï¼šé‡‡ç”¨å››é˜¶ Butterworth å¸¦é€šæ»¤æ³¢ + è‡ªé€‚åº”å³°å€¼æ£€æµ‹ç®—æ³•
- ğŸ’‰ **è¡€æ°§é¥±å’Œåº¦æµ‹é‡**ï¼šåŸºäºçº¢å…‰/çº¢å¤–å…‰æ¯”å€¼è®¡ç®— SpO2
- ğŸ“Š **å®æ—¶æ³¢å½¢æ˜¾ç¤º**ï¼š128x64 OLED æ˜¾ç¤ºå®æ—¶ PPG ä¿¡å·æ³¢å½¢
- ğŸ¯ **ç¨³å®šçš„æ˜¾ç¤º**ï¼šå¤šçº§å¹³æ»‘ç®—æ³•ç¡®ä¿æ˜¾ç¤ºå€¼ç¨³å®šä¸è·³åŠ¨
- âš¡ **å¿«é€Ÿå“åº”**ï¼šçº¦ 5 ç§’å®Œæˆåˆå§‹åŒ–å¹¶æ˜¾ç¤ºæœ‰æ•ˆå¿ƒç‡
- ğŸ”¬ **åŒç®—æ³•æ”¯æŒ**ï¼šæä¾›æ—¶åŸŸå³°å€¼æ£€æµ‹å’Œé¢‘åŸŸDPTå˜æ¢ä¸¤ç§ç®—æ³•å¯é€‰

## ğŸ¥ æ¼”ç¤ºæ•ˆæœ

### OLED æ˜¾ç¤ºå¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HR:85    SpO2:98%                â”‚  â† å¿ƒç‡å’Œè¡€æ°§æ•°å€¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚      å®æ—¶ PPG æ³¢å½¢         â”‚   â”‚  â† å¿ƒç‡æ³¢å½¢æ˜¾ç¤º
â”‚ â”‚    ~~~     ~~~     ~~~     â”‚   â”‚
â”‚ â”‚  ~~~  ~~~  ~~~  ~~~   ~~~  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ç¡¬ä»¶é…ç½®

### æ ¸å¿ƒç¡¬ä»¶
- **MCU**: STM32F103C8T6 (72MHz, 64KB Flash, 20KB RAM)
- **ä¼ æ„Ÿå™¨**: MAX30102 (å¿ƒç‡è¡€æ°§ä¼ æ„Ÿå™¨)
- **æ˜¾ç¤º**: 0.96" OLED (128x64, I2C)
- **è°ƒè¯•**: UART2 (ä¸²å£è¾“å‡º)

### å¼•è„šè¿æ¥
```
MAX30102 -> STM32F103C8T6
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
VIN  -> 3.3V
GND  -> GND
SDA  -> PB7 (è½¯ä»¶I2C)
SCL  -> PB6 (è½¯ä»¶I2C)
INT  -> PB1 (å¤–éƒ¨ä¸­æ–­, å¯é€‰)

OLED -> STM32F103C8T6
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
VCC  -> 3.3V
GND  -> GND
SDA  -> PB9 (I2C1)
SCL  -> PB8 (I2C1)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- **IDE**: STM32CubeIDE / Keil MDK / IAR
- **å·¥å…·é“¾**: ARM GCC
- **è°ƒè¯•å™¨**: ST-Link V2
- **Python** (å¯é€‰ï¼Œç”¨äºæ•°æ®åˆ†æ): Python 3.7+

### ç¼–è¯‘æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/your-username/STM32-MAX30102.git
cd STM32-MAX30102/MAX30102
```

2. **æ‰“å¼€é¡¹ç›®**
   - ä½¿ç”¨ STM32CubeIDE æ‰“å¼€é¡¹ç›®æ ¹ç›®å½•
   - æˆ–ä½¿ç”¨ Keil æ‰“å¼€ `.uvprojx` æ–‡ä»¶

3. **ç¼–è¯‘å›ºä»¶**
```bash
# ä½¿ç”¨ CMake (æ¨è)
mkdir build && cd build
cmake ..
make

# æˆ–ä½¿ç”¨ STM32CubeIDE
å³é”®é¡¹ç›® -> Build Project
```

4. **çƒ§å½•å›ºä»¶**
```bash
# ä½¿ç”¨ st-flash
st-flash write build/MAX30102.bin 0x8000000

# æˆ–ä½¿ç”¨ STM32CubeIDE
å³é”®é¡¹ç›® -> Run As -> STM32 C/C++ Application
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
MAX30102/
â”œâ”€â”€ Core/
â”‚   â”œâ”€â”€ Inc/                      # å¤´æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ main.h
â”‚   â”‚   â”œâ”€â”€ ppg_filter.h          # æ»¤æ³¢ç®—æ³•å¤´æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ ppg_algorithm.h       # å¿ƒç‡è¡€æ°§ç®—æ³•å¤´æ–‡ä»¶ (æ–¹æ³•1)
â”‚   â”‚   â””â”€â”€ ppg_algorithm_v2.h    # DPTç®—æ³•å¤´æ–‡ä»¶ (æ–¹æ³•2)
â”‚   â””â”€â”€ Src/                      # æºæ–‡ä»¶
â”‚       â”œâ”€â”€ main.c                # ä¸»ç¨‹åº
â”‚       â”œâ”€â”€ ppg_filter.c          # æ»¤æ³¢ç®—æ³•å®ç°
â”‚       â”œâ”€â”€ ppg_algorithm.c       # å¿ƒç‡è¡€æ°§ç®—æ³•å®ç° (æ–¹æ³•1)
â”‚       â”œâ”€â”€ ppg_algorithm_v2.c    # DPTç®—æ³•å®ç° (æ–¹æ³•2)
â”‚       â””â”€â”€ main_usage_example.c  # åŒç®—æ³•ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ Drivers/                      # HAL é©±åŠ¨åº“
â”‚   â”œâ”€â”€ STM32F1xx_HAL_Driver/
â”‚   â””â”€â”€ CMSIS/
â”œâ”€â”€ lib/                          # å¤–è®¾åº“
â”‚   â””â”€â”€ oled/
â”‚       â”œâ”€â”€ inc/
â”‚       â”‚   â”œâ”€â”€ oled.h            # OLED é©±åŠ¨
â”‚       â”‚   â”œâ”€â”€ max30102.h        # MAX30102 é©±åŠ¨
â”‚       â”‚   â””â”€â”€ soft_i2c.h        # è½¯ä»¶ I2C
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ oled.c
â”‚           â”œâ”€â”€ max30102.c
â”‚           â”œâ”€â”€ soft_i2c.c
â”‚           â””â”€â”€ font.c
â”œâ”€â”€ CMakeLists.txt                # CMake æ„å»ºé…ç½®
â”œâ”€â”€ README.md                     # æœ¬æ–‡ä»¶
â”œâ”€â”€ .gitignore                    # Git å¿½ç•¥æ–‡ä»¶
â””â”€â”€ docs/                         # æ–‡æ¡£ç›®å½•
    â”œâ”€â”€ algorithm.md              # ç®—æ³•è¯´æ˜
    â””â”€â”€ hardware.md               # ç¡¬ä»¶è¯´æ˜
```

## ğŸ§® æ ¸å¿ƒç®—æ³•

æœ¬é¡¹ç›®æä¾›ä¸¤ç§å¿ƒç‡å’Œè¡€æ°§è®¡ç®—æ–¹æ³•ï¼Œå¯æ ¹æ®éœ€æ±‚é€‰æ‹©ï¼š

### **æ–¹æ³• 1: æ—¶åŸŸå³°å€¼æ£€æµ‹ç®—æ³•** (é»˜è®¤)
- ğŸ“ æ–‡ä»¶: `ppg_algorithm.c/h`
- ğŸ“– å‚è€ƒ: è‡ªç ”ç®—æ³•ï¼ŒåŸºäºä¼ ç»ŸDSPæ–¹æ³•
- âš¡ ç‰¹ç‚¹: å¿«é€Ÿå“åº”ï¼ˆ~5ç§’ï¼‰ï¼Œä½å†…å­˜ï¼ˆ~2KBï¼‰
- ğŸ¯ é€‚ç”¨: éœ€è¦å¿«é€Ÿå“åº”çš„å®æ—¶ç›‘æµ‹åœºæ™¯

### **æ–¹æ³• 2: é¢‘åŸŸDPTå˜æ¢ç®—æ³•** (æ–°å¢)
- ğŸ“ æ–‡ä»¶: `ppg_algorithm_v2.c/h`
- ğŸ“– å‚è€ƒ: [Analog Devices RAQ-230](https://www.analog.com/cn/resources/analog-dialogue/raqs/raq-issue-230.html)
- âš¡ ç‰¹ç‚¹: é«˜ç²¾åº¦ï¼ˆ~10ç§’ï¼‰ï¼Œä¸­ç­‰å†…å­˜ï¼ˆ~8KBï¼‰
- ğŸ¯ é€‚ç”¨: éœ€è¦é«˜ç²¾åº¦å’ŒæŠ—å™ªå£°èƒ½åŠ›çš„åœºæ™¯

### ç®—æ³•å¯¹æ¯”

| ç‰¹æ€§ | æ–¹æ³•1 (æ—¶åŸŸ) | æ–¹æ³•2 (é¢‘åŸŸDPT) |
|------|------------|----------------|
| ç®—æ³•ç±»å‹ | å³°å€¼æ£€æµ‹ | å‘¨æœŸå˜æ¢ |
| åˆå§‹åŒ–æ—¶é—´ | ~5ç§’ | ~10ç§’ |
| å†…å­˜å ç”¨ | ~2KB | ~8KB |
| CPUå ç”¨ | ä½ | ä¸­ |
| æŠ—å™ªå£°èƒ½åŠ› | ä¸­ | é«˜ |
| åˆ†è¾¨ç‡ | ä¸­ | é«˜ |
| é€‚ç”¨åœºæ™¯ | å®æ—¶ç›‘æµ‹ | ç²¾å¯†æµ‹é‡ |

### å¦‚ä½•é€‰æ‹©ç®—æ³•

åœ¨ `main_usage_example.c` ä¸­åˆ‡æ¢ç®—æ³•ï¼š
```c
// æ–¹æ³•1: æ—¶åŸŸå³°å€¼æ£€æµ‹ (é»˜è®¤)
#define USE_METHOD_1

// æ–¹æ³•2: é¢‘åŸŸDPTå˜æ¢
// #define USE_METHOD_2
```

---

## ğŸ“Š æ–¹æ³•1: æ—¶åŸŸå³°å€¼æ£€æµ‹ç®—æ³•è¯¦è§£

### 1. ä¿¡å·å¤„ç†æµç¨‹

```
åŸå§‹ ADC æ•°æ® (18-bit)
         â†“
å»è¶‹åŠ¿æ»¤æ³¢ (50ç‚¹ç§»åŠ¨å¹³å‡)
         â†“
Butterworth 4é˜¶å¸¦é€šæ»¤æ³¢ (0.5-4 Hz)
         â†“
ä¿¡å·å¹³æ»‘ (5ç‚¹ç§»åŠ¨å¹³å‡)
         â†“
å³°å€¼æ£€æµ‹ (7ç‚¹çª—å£)
         â†“
å¼‚å¸¸å€¼è¿‡æ»¤
         â†“
ä¸­ä½æ•°æ»¤æ³¢ (7ç‚¹)
         â†“
EMA å¹³æ»‘ (Î±=0.2)
         â†“
å¿ƒç‡è¾“å‡º (BPM)
```

### 2. æ»¤æ³¢ç®—æ³•

#### å»è¶‹åŠ¿æ»¤æ³¢
```c
// ä½¿ç”¨ç§»åŠ¨å¹³å‡çª—å£å»é™¤åŸºçº¿æ¼‚ç§»
baseline = MovingAverage(signal, 50)
detrended = signal - baseline
```

#### Butterworth å¸¦é€šæ»¤æ³¢å™¨
- **ç±»å‹**: 4é˜¶ Butterworth
- **é¢‘ç‡èŒƒå›´**: 0.5-4 Hz
- **å®ç°**: çº§è”ä¸¤ä¸ªäºŒé˜¶èŠ‚ (SOS)
- **é‡‡æ ·ç‡**: 100 Hz

```c
// çº§è”ä¸¤ä¸ªäºŒé˜¶èŠ‚
y = Biquad1(Biquad2(detrended))
```

### 3. å¿ƒç‡æ£€æµ‹ç®—æ³•

#### å³°å€¼æ£€æµ‹
- **çª—å£å¤§å°**: 7ç‚¹ï¼ˆå‰åå„3ä¸ªæ ·æœ¬ï¼‰
- **æœ€å°é—´éš”**: 40æ ·æœ¬ï¼ˆå¯¹åº”æœ€å¤§150 bpmï¼‰
- **æœ€å¤§é—´éš”**: 250æ ·æœ¬ï¼ˆå¯¹åº”æœ€å°24 bpmï¼‰
- **é˜ˆå€¼**: è‡ªé€‚åº”ï¼ˆmean + 0.5Ïƒï¼‰

#### å¹³æ»‘è¾“å‡º
- **ä¸­ä½æ•°æ»¤æ³¢**: 7ç‚¹å†å²
- **å˜åŒ–ç‡é™åˆ¶**: Â±6 bpm/æ¬¡
- **EMA å¹³æ»‘**: Î± = 0.2

### 4. è¡€æ°§è®¡ç®—

#### R å€¼è®¡ç®—
```c
R = (AC_red / DC_red) / (AC_ir / DC_ir)
```

#### SpO2 æ ¡å‡†å…¬å¼
```c
SpO2 = -45.06 Ã— RÂ² + 30.354 Ã— R + 94.845
```

### 5. æ˜¾ç¤ºç¨³å®šåŒ–

#### åŒå±‚å¹³æ»‘
```c
// ç®—æ³•å±‚: Î± = 0.2
heart_rate = 0.2 Ã— new + 0.8 Ã— old

// æ˜¾ç¤ºå±‚: Î± = 0.1 + é˜ˆå€¼è¿‡æ»¤
if (|hr - displayed_hr| > 2.0) {
    displayed_hr = 0.1 Ã— hr + 0.9 Ã— displayed_hr
}
```

---

## ğŸ“Š æ–¹æ³•2: é¢‘åŸŸDPTå˜æ¢ç®—æ³•è¯¦è§£

### 1. ä¿¡å·å¤„ç†æµç¨‹

```
åŸå§‹ ADC æ•°æ® (18-bit)
         â†“
IIR æ»¤æ³¢å™¨æå– AC/DC åˆ†é‡
         â†“
æ»‘åŠ¨ DPT å˜æ¢ (å‘¨æœŸåŸŸ)
         â†“
è®¡ç®—å¹…åº¦è°±
         â†“
é¢‘è°±å³°å€¼æ£€æµ‹
         â†“
å¿ƒç‡å’Œ SpO2 è®¡ç®—
```

### 2. IIR AC/DC æå–

#### é«˜é€šæ»¤æ³¢å™¨ (æå–ACåˆ†é‡)
```c
w = input + 0.99 * w_prev
AC = w - w_prev
w_prev = w
```

#### ä½é€šæ»¤æ³¢å™¨ (æå–DCåˆ†é‡)
```c
DC = 0.99 * DC_prev + 0.01 * input
DC_prev = DC
```

### 3. ç¦»æ•£å‘¨æœŸå˜æ¢ (DPT)

#### æ ¸å¿ƒåŸç†
- ä¸åŒäºDFTåœ¨é¢‘åŸŸåˆ†æï¼ŒDPTåœ¨**å‘¨æœŸåŸŸ**åˆ†æ
- å‘¨æœŸèŒƒå›´: 40-200 samples (30-150 bpm)
- é€’å½’ç¼“å†²åŒº: 1000 samples (10ç§’æ•°æ®)

#### å˜æ¢å…¬å¼
```c
T_i(s) = e^(j2Ï€s) * [T_{i-1}(s) - x(i-period) + x(i)]
```

#### å®ç°æ–¹å¼
- ä½¿ç”¨é¢„è®¡ç®—çš„åŸºå‡½æ•° (cos/sin)
- çº§è”å¤æ•°æ—‹è½¬
- æ»‘åŠ¨çª—å£æ›´æ–°

### 4. å¿ƒç‡è®¡ç®—

#### ä»é¢‘è°±å³°å€¼ç›´æ¥è®¡ç®—
```c
peak_period = FindPeakInSpectrum(magnitude_spectrum)
heart_rate = 6000 / peak_period  // å•ä½: bpm
```

### 5. è¡€æ°§è®¡ç®—

#### ä½¿ç”¨é¢‘è°±å¹…åº¦ä½œä¸ºACåˆ†é‡
```c
AC_red = magnitude_red[peak_index]
AC_ir = magnitude_ir[peak_index]

R = (AC_red / DC_red) / (AC_ir / DC_ir)
SpO2 = -45.06 Ã— RÂ² + 30.354 Ã— R + 94.845
```

### 6. DPT ç®—æ³•ä¼˜åŠ¿

- âœ… **é«˜åˆ†è¾¨ç‡**: å‘¨æœŸåŸŸåˆ†è¾¨ç‡ä¼˜äºDFT
- âœ… **æŠ—å™ªå£°**: é¢‘è°±åˆ†æå¤©ç„¶æŠ—å™ª
- âœ… **æ— éœ€å³°å€¼æ£€æµ‹**: ç›´æ¥ä»é¢‘è°±è·å–ä¿¡æ¯
- âœ… **ç†è®ºåŸºç¡€**: åŸºäºAnalog Devicesè®ºæ–‡éªŒè¯

---

## âš™ï¸ é…ç½®å‚æ•°

### æ–¹æ³•1 é…ç½®å‚æ•°

#### æ»¤æ³¢å‚æ•° (ppg_filter.h)
```c
#define DETREND_WINDOW_SIZE  50    // å»è¶‹åŠ¿çª—å£å¤§å°
#define SIGNAL_SMOOTH_SIZE   5     // ä¿¡å·å¹³æ»‘çª—å£
```

#### å¿ƒç‡ç®—æ³•å‚æ•° (ppg_algorithm.h)
```c
#define HR_BUFFER_SIZE       250   // å¿ƒç‡ç¼“å†²åŒº (2.5ç§’)
#define MIN_PEAK_DISTANCE    40    // æœ€å°å³°å€¼é—´éš”
#define PEAK_THRESHOLD       0.5f  // å³°å€¼é˜ˆå€¼ç³»æ•°
#define HR_EMA_ALPHA         0.2f  // EMA å¹³æ»‘ç³»æ•°
#define MAX_HR_CHANGE        6.0f  // æœ€å¤§å˜åŒ–ç‡
```

#### æ˜¾ç¤ºå‚æ•° (main.c)
```c
#define DISPLAY_EMA_ALPHA       0.1f   // æ˜¾ç¤ºå¹³æ»‘ç³»æ•°
#define DISPLAY_HR_THRESHOLD    2.0f   // æ˜¾ç¤ºæ›´æ–°é˜ˆå€¼
#define WAVE_SAMPLE_INTERVAL    2      // æ³¢å½¢é‡‡æ ·é—´éš”
```

### æ–¹æ³•2 é…ç½®å‚æ•°

#### DPT ç®—æ³•å‚æ•° (ppg_algorithm_v2.h)
```c
#define DPT_SAMPLE_RATE_HZ   100       // é‡‡æ ·ç‡
#define DPT_MIN_PERIOD       40        // æœ€å°å‘¨æœŸ (150 bpm)
#define DPT_MAX_PERIOD       200       // æœ€å¤§å‘¨æœŸ (30 bpm)
#define DPT_BUFFER_SIZE      1000      // é€’å½’ç¼“å†²åŒº (10ç§’)
#define DPT_R_SMOOTH_SIZE    10        // Rå€¼å¹³æ»‘çª—å£
#define DPT_HR_SMOOTH_SIZE   5         // å¿ƒç‡å¹³æ»‘çª—å£
```

#### IIR æ»¤æ³¢å™¨å‚æ•° (ppg_algorithm_v2.c)
```c
#define IIR_HP_COEFF         0.99f     // é«˜é€šæ»¤æ³¢ç³»æ•°
#define IIR_LP_COEFF         0.99f     // ä½é€šæ»¤æ³¢ç³»æ•°
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æ–¹æ³•1 (æ—¶åŸŸå³°å€¼æ£€æµ‹)

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| å¿ƒç‡æµ‹é‡èŒƒå›´ | 30-150 bpm |
| å¿ƒç‡ç²¾åº¦ | Â±3 bpm |
| è¡€æ°§æµ‹é‡èŒƒå›´ | 70-100% |
| è¡€æ°§ç²¾åº¦ | Â±2% |
| åˆå§‹ç¨³å®šæ—¶é—´ | ~5ç§’ |
| æ›´æ–°é¢‘ç‡ | 2.5ç§’/æ¬¡ |
| CPUå ç”¨ç‡ | <30% |
| å†…å­˜å ç”¨ | ~2KB RAM |

### æ–¹æ³•2 (é¢‘åŸŸDPTå˜æ¢)

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| å¿ƒç‡æµ‹é‡èŒƒå›´ | 30-150 bpm |
| å¿ƒç‡ç²¾åº¦ | Â±2 bpm (ç†è®º) |
| è¡€æ°§æµ‹é‡èŒƒå›´ | 70-100% |
| è¡€æ°§ç²¾åº¦ | Â±2% |
| åˆå§‹ç¨³å®šæ—¶é—´ | ~10ç§’ |
| æ›´æ–°é¢‘ç‡ | æ¯é‡‡æ ·æ›´æ–° |
| CPUå ç”¨ç‡ | <50% |
| å†…å­˜å ç”¨ | ~8KB RAM |
| é¢‘è°±åˆ†è¾¨ç‡ | 161ç‚¹ (40-200å‘¨æœŸ) |

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. æ˜¾ç¤º "Signal weak"**
- æ£€æŸ¥æ‰‹æŒ‡æ˜¯å¦ç´§è´´ä¼ æ„Ÿå™¨
- ç¡®ä¿æ‰‹æŒ‡å¹²å‡€æ— æ±¡å¢
- æ£€æŸ¥ MAX30102 ä¾›ç”µæ˜¯å¦æ­£å¸¸
- å°è¯•è°ƒæ•´æ‰‹æŒ‡ä½ç½®

**2. å¿ƒç‡å€¼ä¸å‡†ç¡®**
- è°ƒæ•´ `PEAK_THRESHOLD` (å‡å°åˆ° 0.4)
- è°ƒæ•´ `MIN_PEAK_DISTANCE` (å¢å¤§åˆ° 50)
- ç¡®ä¿æ‰‹æŒ‡é™æ­¢ä¸åŠ¨

**3. æ³¢å½¢ä¸æ˜¾ç¤º**
- æ£€æŸ¥ OLED è¿æ¥
- ç¡®è®¤ I2C åœ°å€æ­£ç¡® (0x3C æˆ– 0x78)
- æ£€æŸ¥ OLED ä¾›ç”µ

**4. å¿ƒç‡æ³¢åŠ¨å¤§**
- å‡å° `HR_EMA_ALPHA` (å¦‚ 0.15)
- å¢å¤§ `MAX_HR_CHANGE` (å¦‚ 5.0)
- å‡å° `DISPLAY_HR_THRESHOLD` (å¦‚ 1.5)

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æé«˜å‡†ç¡®æ€§
1. å¢åŠ ç¼“å†²åŒºå¤§å°åˆ° 300 (3ç§’)
2. é™ä½ EMA ç³»æ•°åˆ° 0.15
3. ä½¿ç”¨æ›´ä¸¥æ ¼çš„å³°å€¼æ£€æµ‹çª—å£

### æé«˜å“åº”é€Ÿåº¦
1. å‡å°ç¼“å†²åŒºåˆ° 200 (2ç§’)
2. æé«˜ EMA ç³»æ•°åˆ° 0.25
3. æ”¾å®½å˜åŒ–ç‡é™åˆ¶åˆ° 8 bpm

### é™ä½åŠŸè€—
1. é™ä½é‡‡æ ·ç‡åˆ° 50 Hz
2. å‡å°‘ OLED åˆ·æ–°é¢‘ç‡
3. ä½¿ç”¨ä½åŠŸè€—æ¨¡å¼

## ğŸ”¬ æ•°æ®å¯¼å‡º

### ä¸²å£è¾“å‡ºæ ¼å¼
```
HR: 85.0 BPM (Valid)
SpO2: 98.0 %
R,125432,I,134567
```

### ä½¿ç”¨ Python é‡‡é›†æ•°æ®
```python
import serial
import matplotlib.pyplot as plt

ser = serial.Serial('COM3', 115200)
data = []

while True:
    line = ser.readline().decode('utf-8').strip()
    if line.startswith('R,'):
        parts = line.split(',')
        red = int(parts[1])
        ir = int(parts[3])
        data.append((red, ir))

        # å®æ—¶ç»˜å›¾
        if len(data) > 500:
            data = data[-500:]
        plt.plot([d[1] for d in data])
        plt.pause(0.01)
```

## ğŸ“ å¾…æ”¹è¿›åŠŸèƒ½

- [ ] æ·»åŠ å¿ƒç‡å˜å¼‚æ€§ (HRV) åˆ†æ
- [ ] å®ç°æ•°æ®å­˜å‚¨åˆ° SD å¡
- [ ] æ·»åŠ è“ç‰™ä¼ è¾“åŠŸèƒ½
- [ ] ä¼˜åŒ–ä½ç”µé‡æ¨¡å¼
- [ ] å¢åŠ å¤šç”¨æˆ·é…ç½®æ–‡ä»¶
- [ ] æ·»åŠ å¼‚å¸¸å¿ƒç‡æŠ¥è­¦

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘æµç¨‹
1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ‘¥ ä½œè€…

- **é¡¹ç›®å¼€å‘**: Your Name
- **ç®—æ³•è®¾è®¡**: Claude Code
- **ç¡¬ä»¶è®¾è®¡**: Your Name

## ğŸ™ è‡´è°¢

- STMicroelectronics - HAL åº“
- Maxim Integrated - MAX30102 æ•°æ®æ‰‹å†Œ
- å¼€æºç¤¾åŒºçš„å„ä½è´¡çŒ®è€…

## ğŸ“ è”ç³»æ–¹å¼

- Email: your.email@example.com
- GitHub: [@your-username](https://github.com/your-username)
- é¡¹ç›®ä¸»é¡µ: [STM32-MAX30102](https://github.com/your-username/STM32-MAX30102)

## ğŸ“š å‚è€ƒèµ„æ–™

1. MAX30102 Datasheet - [Maxim Integrated](https://www.maximintegrated.com/)
2. "A Simple Algorithm for Pulse Oximetry" - IEEE è®ºæ–‡
3. STM32F103 Reference Manual - [STMicroelectronics](https://www.st.com/)
4. Digital Signal Processing - æ•°å­—ä¿¡å·å¤„ç†ç†è®º

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼
